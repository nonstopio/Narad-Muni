generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Update {
  id             String   @id @default(uuid())
  createdAt      DateTime @default(now())
  date           DateTime
  rawTranscript  String
  audioPath      String?
  slackOutput    String   @default("")
  teamsOutput    String   @default("")
  slackStatus    String   @default("PENDING")
  teamsStatus    String   @default("PENDING")
  jiraStatus     String   @default("PENDING")
  workLogEntries WorkLogEntry[]
}

model WorkLogEntry {
  id             String   @id @default(uuid())
  updateId       String
  update         Update   @relation(fields: [updateId], references: [id], onDelete: Cascade)
  issueKey       String
  timeSpentSecs  Int
  started        DateTime
  comment        String?
  isRepeat       Boolean  @default(false)
  jiraWorklogId  String?
}

model PlatformConfig {
  id              String   @id @default(uuid())
  platform        String
  userName        String?
  userId          String?
  webhookUrl      String?
  apiToken        String?
  baseUrl         String?
  email           String?
  projectKey      String?
  timezone        String?
  teamLeadName    String?
  teamLeadId      String?
  slackBotToken   String?
  slackChannelId  String?
  slackThreadMode Boolean  @default(true)
  slackThreadMatch String?
  slackWorkflowTime String?
  isActive        Boolean  @default(true)
  repeatEntries   RepeatEntry[]
}

model RepeatEntry {
  id        String         @id @default(uuid())
  configId  String
  config    PlatformConfig @relation(fields: [configId], references: [id], onDelete: Cascade)
  ticketId  String
  hours     Float
  startTime String
  comment   String
}

model AppSettings {
  id                    String  @id @default("app-settings")
  aiProvider            String  @default("local-claude")
  geminiApiKey          String?
  claudeApiKey          String?
  deepgramApiKey        String?
  notificationsEnabled  Boolean @default(false)
  notificationHour      Int     @default(9)
  notificationMinute    Int     @default(0)
  notificationDays      String  @default("1,2,3,4,5")
}

model Draft {
  id            String   @id @default(uuid())
  date          DateTime @unique
  rawTranscript String
  updatedAt     DateTime @updatedAt
}
